#!/usr/bin/python3
# Generate the micron_genconfig.h file
# Copyright (c) 2024 bellrise

import os

DEFAULT_OPTS = "dist/default.config"
LOCAL_OPTS = "dist/local.config"

# TODO: make this file pretty

if not os.path.exists(DEFAULT_OPTS):
    print("Missing default option file:", DEFAULT_OPTS)
    exit(1)

config = {}


def parse(file):
    blob = {}

    with open(file) as f:
        lines = f.readlines()
    for line in lines:
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        k, v = line.split("=", maxsplit=1)
        blob[k] = v

    return blob


config.update(parse(DEFAULT_OPTS))
if os.path.isfile(LOCAL_OPTS):
    config.update(parse(LOCAL_OPTS))

print(
    """/* micron_genconfig.h
   Generated by Micron build process */

#ifndef MICRON_GENCONFIG_H
#define MICRON_GENCONFIG_H 1
   """
)

for k, v in config.items():
    a = f"#define MICRON_CONFIG_{k} "
    b = " " * max(40 - len(a), 0)
    print(a, b, v)

print("\n#endif /* MICRON_GENCONFIG_H */")
